var CardboardClient,Four;Four={},CardboardClient=function(){function a(){this.renderer=new THREE.WebGLRenderer||new THREE.CanvasRenderer,this.clientId=null,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1e4),this.camera.position.z=4,this.active=!0,this.objects={},this.pin=-1,this.controller=!1,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.io=io(),this.setCallbacks()}return a.prototype.setCallbacks=function(){var a,b,c;return b=new THREE.ObjectLoader,this.io.on("connect",function(a){return function(){return a.io.emit("cardboard",a.pin),a.controller=!0}}(this)),this.io.on("message",function(a){return function(b){return"error"===b?(a.controller=!1,a.io.disconnect(),$(".clientId").show()):void 0}}(this)),this.io.on("add",function(a){return function(c){return b.parse(c,function(b){return a.scene.add(b),a.objects[c.object.userData.id]=b})}}(this)),this.io.on("remove",function(a){return function(b){var c;return c=a.objects[b],a.scene.remove(c),delete a.objects[b]}}(this)),this.io.on("update",function(a){return function(b){var c,d,e;return c=a.objects[b.id],null==c?a.io.emit("info",{id:b.id}):(d=b.position,e=b.rotation,c.rotation.set(e.x,e.y,e.z,e.order),c.position.set(d.x,d.y,d.z))}}(this)),this.io.on("object",function(a){return function(c){return null==a.objects[c.object.userData.id]?b.parse(c,function(b){return a.objects[c.object.userData.id]=b,a.scene.add(b)}):void 0}}(this)),a=new THREE.StereoEffect(renderer),a.eyeSeparation=10,a.setSize(window.innerWidth,window.innerHeight),c=window.sense.init(),c.orientation(function(a){return function(b){return a.controller?(a.camera.rotation.y=90-gamma,a.camera.rotation.x=beta,a.camera.rotation.z=alpha,a.io.emit("head",{x:rotation.x,y:rotation.y,z:rotation.z})):void 0}}(this)),this.animate()},a.prototype.setPinAndConnect=function(){return this.pin=$("input#pinInput").val(),$(".clientId").hide()},a.prototype.reconnect=function(){return this.io=io(),this.setCallbacks()},a.prototype.animate=function(){return requestAnimationFrame(function(a){return function(){return a.animate()}}(this)),this.renderer.render(this.scene,this.camera)},a}(),Four.CardboardClient=CardboardClient;